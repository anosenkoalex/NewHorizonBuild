# Техническое задание  
## CRM для строительной компании (учет продаж + 3D-модели объектов)

## 1. Общая информация о системе

CRM-система для строительной компании предназначена для:

- учета и управления продажами объектов недвижимости (квартиры, коммерческая недвижимость);
- отображения актуальной информации по статусам объектов;
- ведения внутреннего документооборота;
- предоставления статистики и отчетов для отдела продаж;
- визуализации объектов на основе существующих 3D-моделей зданий с детализацией до конкретной квартиры/дома и планировки.

Система реализуется как веб-приложение (доступ с ПК и, по возможности, с планшетов/мобилок через браузер).

## 2. Цели и задачи проекта

### 2.1. Основные цели

1. Обеспечить прозрачный учет продаж объектов недвижимости.
2. Дать отделу продаж и руководству быструю картину по статусам: свободно / продано / резерв / рассрочка / долевое.
3. Реализовать единый документооборот по сделкам внутри компании.
4. Обеспечить наглядную визуализацию строящихся объектов через интеграцию с уже существующими 3D-моделями.
5. Обеспечить удобную отчетность и аналитику для отдела продаж и руководства.

### 2.2. Основные пользователи системы

- Сотрудники отдела продаж.
- Руководитель отдела продаж.
- Руководство компании.
- Юридический отдел / документооборот.
- Администраторы системы (IT / поддержка).

## 3. Функциональные требования

### 3.1. Учет объектов недвижимости

Система должна предоставлять:

1. Справочник объектов недвижимости:
   - Жилые комплексы / дома / корпуса.
   - Квартиры.
   - Коммерческая недвижимость (офисы, магазины и т.п.).

2. Для каждой квартиры / помещения хранится как минимум:
   - идентификатор (ID);
   - тип объекта: квартира / коммерческое помещение / паркинг и т.д.;
   - принадлежность к проекту: ЖК / дом / корпус / секция / этаж;
   - площадь (общая, жилая, при необходимости — кухня и т.п.);
   - количество комнат;
   - цена (базовая и др. при необходимости);
   - текущий статус (см. 3.2);
   - информация о клиенте (если объект в процессе сделки или продан);
   - связь с 3D-моделью (см. 3.5).

3. Интерфейс просмотра:
   - список объектов (таблица с фильтрами и поиском);
   - фильтры: по статусу, типу объекта, ЖК, корпусу, этажу, площади, цене и т.д.;
   - быстрый просмотр карточки объекта.

### 3.2. Статусы объектов

Для объектов недвижимости должны поддерживаться статусы:

- **Свободно** (по умолчанию);
- **Резерв**;
- **Продано**;
- **Рассрочка** (продано по рассрочке);
- **Долевое** (продано по схеме долевого участия).

Требования:

- История смены статусов должна сохраняться (кто, когда, с какого на какой).
- Изменение статуса отражается:
  - в карточке объекта,
  - в отчетах,
  - на 3D-модели (цвет/обозначения, см. 3.5).
- Возможность ограничения прав: не все роли могут менять статус.

### 3.3. Документооборот внутри компании

Типы документов (минимум):

- договор бронирования / резерва;
- договор купли-продажи;
- договор долевого участия;
- графики платежей / рассрочки;
- дополнительные соглашения.

Требования:

- Шаблоны документов с автозаполнением полей:
  - данные клиента;
  - данные по объекту (адрес, этаж, площадь, цена, статус);
  - условия оплаты.
- Хранение документов в системе:
  - привязка документа к объекту и к клиенту;
  - разграничение доступа (кто может видеть/скачивать/редактировать).
- Возможность загрузки сканов/подписанных документов (PDF, изображения).
- Выгрузка документа в формате PDF/Docx для печати или отправки.

### 3.4. Статистика и отчеты для отдела продаж

1. Отчеты по проданным объектам:
   - количество проданных объектов за период (день, месяц, квартал, год);
   - разбивка по:
     - типу объекта (квартиры, коммерческая недвижимость),
     - проекту / ЖК / корпусу,
     - статусу сделки (продано / рассрочка / долевое),
     - менеджеру по продажам;
   - общая выручка и выручка по категориям.

2. Дополнительные отчеты:
   - количество объектов в резерве;
   - воронка продаж (заявка → резерв → договор → оплата);
   - статистика по клиентам (по желанию).

3. Требования к отчетам:
   - фильтры: по датам, менеджерам, проектам, типам объектов, статусам;
   - выгрузка в XLSX/CSV/PDF;
   - доступ к отчетам в зависимости от роли.

### 3.5. Интеграция с существующими 3D-моделями зданий

#### 3.5.1. Исходные данные

- 3D-модели всех строящихся объектов уже существуют (здания/ЖК).
- Нужно:
  - зафиксировать используемые форматы (например, `.fbx`, `.obj`, `.skp`, `.rvt`, `.3ds` и т.д.);
  - описать, в каком ПО сейчас эти модели используются (Revit, ArchiCAD, 3ds Max, SketchUp и т.п.).
- При необходимости предусмотреть конвертацию в web-дружелюбный формат (например, **glTF/GLB**) для отображения через браузер.

#### 3.5.2. Просмотр 3D-моделей в CRM

- Модели отображаются прямо в браузере, без установки отдельного ПО.
- Возможная реализация: WebGL-viewer (three.js / Babylon.js / другой).
- Базовый функционал:
  - вращение модели (orbit);
  - масштабирование (zoom in/out);
  - панорамирование камеры;
  - выбор:
    - ЖК / дом / корпус / секция / этаж,
    - конкретной квартиры / помещения.

#### 3.5.3. Привязка 3D-модели к данным CRM

Каждая квартира/помещение в БД CRM связывается с элементом 3D-сцены.

- В БД у объекта должны быть поля:
  - `project_id` / `building_id` / `section_id` / `floor` / `apartment_id`;
  - `modelElementKey` — идентификатор элемента в 3D-модели (ID/имя/UUID).

Поведение:

- Из 3D в CRM:
  - при клике на квартиру/помещение в 3D открывается карточка соответствующего объекта.
- Из CRM в 3D:
  - в карточке объекта есть кнопка «Показать на 3D-модели»;
  - открывает 3D-viewer, позиционирует камеру на нужной квартире, подсвечивает её.

#### 3.5.4. Отображение статусов на 3D-модели

Необходимо визуально показывать статус объекта на модели:

- Свободно – базовый цвет;
- Резерв – цвет №1;
- Продано – цвет №2;
- Рассрочка – цвет №3;
- Долевое – цвет №4.

Требования:

- легенда статусов (цвет → статус) отображается рядом с 3D-viewer;
- обновление цвета происходит автоматически при изменении статуса в CRM.

#### 3.5.5. Просмотр планировки квартиры/дома

При выборе/приближении квартиры или помещения:

- отображается планировка (картинка, 2D-схема или отдельный 2D-view);
- информация:
  - план квартиры/помещения;
  - площадь, количество комнат;
  - цена;
  - статус;
  - тип сделки (продажа / рассрочка / долевое).

Источники планировки:

- хранение плана как изображения (PNG/JPEG/PDF) и привязка к объекту;
- либо отдельный модуль 2D-планировок (по согласованию).

Доступ к планировке:

- по клику на объект в 3D;
- из таблицы/списка объектов (кнопка «Планировка»).

#### 3.5.6. Производительность

- 3D-viewer должен быть оптимизирован под офисные ПК отдела продаж.
- При необходимости использовать LOD и ленивую загрузку:
  - сначала общий вид дома,
  - затем секция → этаж → квартира.

#### 3.5.7. Админ-функции по 3D

В административной части CRM есть раздел «3D-модели»:

- загрузка/обновление файлов 3D-моделей для проектов;
- привязка 3D-модели к конкретному ЖК/дому;
- опционально: интерфейс ручной привязки «элемент модели → объект в БД».

### 3.6. Роли пользователей и управление доступом

Минимальный набор ролей:

1. Администратор системы:
   - управление пользователями и ролями;
   - доступ ко всем объектам и настройкам;
   - управление справочниками, статусами, 3D-моделями.

2. Менеджер по продажам:
   - просмотр списка объектов и статусов;
   - изменение статусов объектов (в рамках прав);
   - работа с клиентами и сделками;
   - формирование документов;
   - просмотр своих отчетов по продажам.

3. Руководитель отдела продаж:
   - все права менеджера;
   - просмотр консолидированных отчетов по отделу;
   - статистика по менеджерам.

4. Руководство / топ-менеджмент:
   - просмотр сводной аналитики и ключевых отчетов;
   - чтение списка объектов и статусов;
   - доступ к 3D-отображению и агрегированным данным.

5. Юридический отдел / документооборот:
   - доступ к документам и договорам;
   - загрузка/просмотр подписанных документов.

Конкретные права (CRUD на объекты, сделки, документы и настройки) фиксируются в матрице доступа.

## 4. Технические требования

1. Архитектура:
   - веб-приложение: фронтенд + backend + БД;
   - возможность масштабирования.

2. Фронтенд:
   - React + Vite;
   - адаптивная верстка под десктоп, приемлемый вид на планшетах;
   - интеграция 3D-viewer (WebGL, three.js/Babylon и т.п.).

3. Backend:
   - Node.js (NestJS);
   - REST/GraphQL API;
   - авторизация/аутентификация (например, JWT).

4. База данных:
   - реляционная БД (PostgreSQL);
   - нормализованная схема под:
     - проекты / здания / секции / этажи / квартиры / помещения;
     - статусы;
     - сделки / клиенты;
     - документы;
     - связи с 3D-моделями.

5. Безопасность и доступ:
   - разграничение прав по ролям;
   - логирование действий пользователей (смена статусов, операции с документами и т.д.).

## 5. Этапы реализации (укрупненно)

1. Каркас системы:
   - базовые сущности БД (объекты, статусы, пользователи, роли);
   - авторизация/аутентификация;
   - простейший интерфейс списка объектов и смены статусов.

2. Документооборот:
   - привязка документов к объектам/клиентам;
   - шаблоны документов;
   - загрузка/выгрузка.

3. Отчеты и статистика:
   - основные отчеты по проданным объектам;
   - фильтры и выгрузка.

4. Интеграция 3D:
   - подключение 3D-viewer;
   - привязка объектов к элементам модели;
   - цвета статусов + планировки.

5. Доработки, оптимизация, UX, права доступа.
